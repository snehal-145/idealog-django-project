{% extends 'base.html' %}

{% block content %}
  <section class="create-hero py-5">
    <div class="container">
      <div class="row align-items-center gx-5">
        <div class="col-md-6" data-aos="fade-right">
          <div class="form-illustration">
            <div class="idea-hero-header">
              <div class="accent-badge" aria-hidden="true"></div>
              <div class="ms-0">
                <h2 class="mt-3">Share your idea with the community</h2>
                <p class="text-muted">Clear, concise ideas get more attention â€” add tags and a short description.</p>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6" data-aos="fade-left">
          <div class="card form-card p-4 rounded-4 shadow-lg" data-aos="zoom-in" data-aos-duration="700">
            <h3 class="mb-3">{% if form.instance.pk %}Edit Idea{% else %}Create New Idea{% endif %}</h3>
            <form method="post">
              {% csrf_token %}
              <div class="mb-3">
                {{ form.title.label_tag }}
                <div class="input-group input-with-icon">
                  <span class="input-icon" aria-hidden="true">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path d="M9 18h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M10 22h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M12 2a7 7 0 00-4 12v2h8v-2a7 7 0 00-4-12z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                  {{ form.title }}
                </div>
                {% for err in form.title.errors %}<div class="text-danger small">{{ err }}</div>{% endfor %}
              </div>
              <div class="mb-3">
                {{ form.description.label_tag }}
                <div class="input-group">
                  {{ form.description }}
                </div>
                <div class="d-flex justify-content-between mt-1">
                  <div>
                    {% for err in form.description.errors %}
                      <div class="text-danger small">{{ err }}</div>
                    {% endfor %}
                  </div>
                  <div id="descCount" class="text-muted small">1200 characters remaining</div>
                </div>
              </div>
              <div class="mb-3">
                {{ form.tags.label_tag }}
                <div class="input-group input-with-icon">
                  <span class="input-icon" aria-hidden="true">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path d="M20.59 13.41L10.59 3.41A2 2 0 009.17 3H5a2 2 0 00-2 2v4.17c0 .53.21 1.04.59 1.41l10 10a2 2 0 002.83 0l4.17-4.17a2 2 0 000-2.83z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M7 7h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                  {{ form.tags }}
                </div>
                <div class="form-text">Add tags separated by commas (optional)</div>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">Tip: keep descriptions concise.</small>
                <div>
                  <button id="submitBtn" type="submit" class="btn btn-primary btn-animated">{% if form.instance.pk %}Update{% else %}Submit Idea{% endif %}</button>
                  <a href="{% url 'ideas:idea_list' %}" class="btn btn-outline-secondary ms-2">Cancel</a>
                </div>
              </div>
            </form>
            <script>
              (function(){
                var ta = document.querySelector('textarea[name="description"]');
                var counter = document.getElementById('descCount');
                var submitBtn = document.getElementById('submitBtn');
                var max = parseInt(ta ? ta.getAttribute('maxlength') || '1200' : '1200');
                function update(){
                  if(!ta) return;
                  var rem = max - ta.value.length;
                  counter.textContent = rem + ' characters remaining';
                  if(rem < 0){
                    counter.classList.add('text-danger');
                    submitBtn.disabled = true;
                    submitBtn.classList.add('disabled');
                  } else {
                    counter.classList.remove('text-danger');
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('disabled');
                  }
                }
                if(ta){ ta.addEventListener('input', update); update(); }
                if(submitBtn){ submitBtn.addEventListener('click', function(){ this.classList.add('btn-clicked'); setTimeout(()=>this.classList.remove('btn-clicked'), 220); }); }
              })();
            </script>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}
